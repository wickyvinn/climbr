<!DOCTYPE HTML>
<html>
  <head>
    <style>
      #section-2, #section-3, #section-4, #section-5, #section-6, #submission, #back {
        display: none;
      }
      table { 
        width: 100%; 
        border-collapse: collapse; 
      }
      /* Zebra striping */
      tr:nth-of-type(odd) { 
        background: #eee; 
      }
      th { 
        background: #333; 
        color: white; 
        font-weight: bold; 
      }
      td, th { 
        padding: 6px; 
        border: 1px solid #ccc; 
        text-align: left; 
      }

/* 
Max width before this PARTICULAR table gets nasty
This query will take effect for any screen smaller than 760px
and also iPads specifically.
*/
@media 
only screen and (max-width: 760px),
(min-device-width: 768px) and (max-device-width: 1024px)  {

  /* Force table to not be like tables anymore */
  table, thead, tbody, th, td, tr { 
    display: block; 
  }
  
  /* Hide table headers (but not display: none;, for accessibility) */
  thead tr { 
    position: absolute;
    top: -9999px;
    left: -9999px;
  }
  
  tr { border: 1px solid #ccc; }
  
  td { 
    /* Behave  like a "row" */
    border: none;
    border-bottom: 1px solid #eee; 
    position: relative;
    padding-left: 50%; 
  }
  
  td:before { 
    /* Now like a table header */
    position: absolute;
    /* Top/left values mimic padding */
    top: 6px;
    left: 6px;
    width: 45%; 
    padding-right: 10px; 
    white-space: nowrap;
  }
  
  /*
  Label the data
  */
  td:nth-of-type(1):before { content: "Name"; }
  td:nth-of-type(2):before { content: "Gender"; }
  td:nth-of-type(3):before { content: "Weight"; }
  td:nth-of-type(4):before { content: "Top rope cert?"; }
  td:nth-of-type(5):before { content: "Lead cert?"; }
  td:nth-of-type(6):before { content: "Generally rope"; }
  td:nth-of-type(7):before { content: "Generally boulder"; }
}


    </style>

    <link rel="stylesheet" href="../css/sign-in.css">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <script src="../js/jquery.min.js"></script>
  </head>
  
  <body>
    <div class="container">
      <form action="/seshinfo">


        <table>
          <thead>
          <tr>
            <th>Name</th>
            <th>Gender</th>
            <th>Weight</th>
            <th>Top</th>
            <th>Lead</th>
            <th>Rope</th>
            <th>Boulder</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td><input type="text" class="editable" name="first_name" value="<%=firstName %>"></input> </td>
            <td>
              <select id="gender" name="gender" class="editable">
                <option value="default">Gender</option>
                <option value="female">Female</option>
                <option value="male">Male</option>
                <option value="declined">Rather not say</option>
              </select>
          </td>
          <td>
            <input id="weight" class="editable" name="weight" type="text" placeholder="lbs" min="20" max="400" value="<%=weight %> lbs"></input> 
          </td>
            <td><input id="top" type="checkbox" class="editable" name="top_cert"></input></td>
            <td><input id="lead" type="checkbox" class="editable" name="lead_cert"></input></td>
            <td>
              <select id="ropeLow" class="editable ropeLevel" name="rope_low"></select> to
              <select id="ropeHigh" class="editable ropeLevel" name="rope_high"></select>
            <td>
              <select id="boulderLow" class="editable boulderLevel" name="boulder_low"></select> to
              <select id="boulderHigh" class="editable boulderLevel" name="boulder_high"></select>
            </td>
          </tr>
          </tbody>
        </table>
        <div class="navigation-buttons">
          <button type="submit">Correct.</button>
        </div>
      </form>
    </div>

    <script>

      $("#gender").val("<%=gender %>");
      $('#top').prop('checked', <%=top %>);
      $('#lead').prop('checked', <%=lead %>);

      $('#weight').blur(function() {
        var weight = $(this).val();
        $(this).attr("type", "text");
        if ($(this).val().length > 0) {
          $(this).val(parseInt($(this).val()).toString() + " lbs");
        }
      });

      $('#weight').focus(function() {
        if ($(this).val().length > 0) {
          $(this).val($(this).val().replace(" lbs", ""));
        }
        $(this).attr("type", "number");
      });

      $(".editable").on("change", function (event) {
        var newValueType = ($(this).attr("name"));
        if (newValueType === "top_cert" || newValueType === "lead_cert") {
          var newValue = $(this).is(":checked");
        } else {
          var newValue = $(this).val();
        }
        var data = {};
        data[newValueType] = newValue;
        console.log("Changed detected for (translated to json): " + JSON.stringify(data));
        $.ajax({
          type: "POST",
          url: "/perminfo/edit",
          xhrFields: {withCredentials: true},
          data: data,
          complete: function() {
            console.log("process has completed.");
          },
          success: function(response) {
            console.log("thing that just got saved (not translated): " + data);
          },
          error: function(XMLHttpRequest, textStatus, errorThrown) {
            console.log("POSTing /perminfo/edit had an error.")
            console.log(errorThrown);
          }
        });
      });

      $(function(){
        var select = $(".ropeLevel");
        var levels = ["5.5", "5.6", "5.7", "5.8", "5.9", "5.10a", "5.10b", "5.10c", "5.10d", "5.11a", "5.11b", "5.11c", "5.11d", "5.12a", "5.12b", "5.12c", "5.12d", "5.13a", "5.13b", "5.13c", "5.13d", "5.14a", "5.14b", "5.14c", "5.14d"];

        select.append($('<option></option>').html("Select a level"));

        for (i=0;i<levels.length;i++) {
          select.append($('<option></option>').val(levels[i]).html(levels[i]))
        }

        $("#ropeLow").val("<%=ropeLow %>");
        $("#ropeHigh").val("<%=ropeHigh %>");

      });

      $(function(){
        var select = $(".boulderLevel");
        var levels = ["VB", "V0", "V1", "V2", "V3", "V4", "V5", "V6", "V7", "V8", "V9", "V10", "V11", "V12", "V13", "V14", "V15", "V16", "V17"];

        select.append($('<option></option>').html("Select a level"));

        for (i=0;i<levels.length;i++) {
          select.append($('<option></option>').val(levels[i]).html(levels[i]))
        }

        $("#boulderLow").val("<%=boulderLow %>");
        $("#boulderHigh").val("<%=boulderHigh %>");

      });
    
    </script>
  </body>
</html>


